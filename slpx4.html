<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="icon" href="favicon.ico" type="image/x-icon">
<title>slpx4</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Fira+Sans+Extra+Condensed:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900&display=swap');
html {/*outline: solid red 2px;*/ display: flex; width: 100%; max-width: 360px; min-width: 360px; margin: 0 auto; overflow-x: hidden;}
body {/*outline: solid green 2px;*/ height: 96vh; background-color: white; margin: 0 auto; margin-top: 26px; overflow-x: hidden;}
p {display: inline-block; outline: solid black 2px; width: 100px; margin: 6px; padding: 6.5px; padding-top: 2px; padding-bottom: 2px; justify-content: center;}
.text-main {text-align: justify; font-family: 'Fira Sans Extra Condensed', sans-serif; /*font-style: italic;*/ font-size: 20px; font-weight: 300;}

#playStopButton {
border: solid black 2px;
width: 80px;
height: 40px;
margin-left: 4px;
margin-top: 4px;
background-color: white;
color: black;}

#bpm-list{
font-family: 'Fira Code';}
</style>
</head>
<body>
</head>
<body>
<p class="text-main" style="font-weight: 400; text-align: center;">slp &ndash; x &ndash; 4</p>
<p class="text-main" style="font-weight: 400; text-align: center;" id="total-time"></p>

<button class="text-main" style="font-weight: 400; text-align: center;" id="playStopButton" onclick="togglePlayback()">START</button>

<div id="bpm-list">&emsp;</div>


<script>
const audioContext = new (window.AudioContext || window.webkitAudioContext)();
let sound1, sound2;
let isPlaying = false;
let bpmIndex = 240;
let playbackTimeouts = [];

function loadSound(url) {
return new Promise((resolve, reject) => {
fetch(url)
.then(response => response.arrayBuffer())
.then(data => {
audioContext.decodeAudioData(data, buffer => resolve(buffer), error => reject(error));})
.catch(error => reject(error));});}

Promise.all([loadSound('click-strong.wav'), loadSound('click-weak.wav')])
.then(([buffer1, buffer2]) => {
sound1 = buffer1;
sound2 = buffer2;})
.catch(error => console.error('Error loading sounds:', error));

function playSound(soundBuffer, delay) {
setTimeout(() => {
const source = audioContext.createBufferSource();
source.buffer = soundBuffer;
source.connect(audioContext.destination);
source.start(0);
}, delay * 1000);}

function calculateTimeForBPM(bpm) {
return (60 / bpm) * 16;}

function startPlayback() {
const bpmList = document.getElementById('bpm-list');
bpmList.innerHTML = '';
bpmIndex = 240;

function playNextBPM() {
if (bpmIndex < 8 || !isPlaying) return;
let timePerBar = calculateTimeForBPM(bpmIndex);
const bpmItem = document.createElement('p');
bpmItem.textContent = `bpm: ${bpmIndex},${timePerBar.toFixed(2)} s`;
/*bpmList.appendChild(bpmItem);*/
for (let repeatOuter = 0; repeatOuter < 2; repeatOuter++) {
for (let i = 0; i < 16; i++) {
const delay = i * (timePerBar / 16);

if (i === 0 || i === 4 || i === 8 || i === 12) {
playSound(sound1, delay);
} else {
playSound(sound2, delay);}}}

bpmIndex--;
playbackTimeouts.push(setTimeout(playNextBPM, timePerBar * 1000));}
playNextBPM();}

function togglePlayback() {
if (isPlaying) {
isPlaying = false;
document.getElementById('playStopButton').textContent = 'START';
playbackTimeouts.forEach(timeout => clearTimeout(timeout));
playbackTimeouts = [];
} else {
isPlaying = true;
document.getElementById('playStopButton').textContent = 'STOP';
startPlayback();}}

function calculateTotalTime() {
let totalTime = 0;
for (let bpm = 240; bpm >= 8; bpm--) {
totalTime += calculateTimeForBPM(bpm);}
return totalTime;}
const totalTimeInSeconds = calculateTotalTime();
const minutes = Math.floor(totalTimeInSeconds / 60);
const seconds = Math.round(totalTimeInSeconds % 60);
document.getElementById('total-time').textContent = `${minutes} m ${seconds} s`;
</script>


</body>
</html>